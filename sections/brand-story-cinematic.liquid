{% schema %}
{
  "name": "Brand Story Split",
  "tag": "section",
  "class": "section-brand-story-split",
  "settings": [
    {
      "type": "range",
      "id": "section_height",
      "min": 400,
      "max": 900,
      "step": 50,
      "unit": "px",
      "label": "Section Height",
      "default": 600,
      "info": "Height of each story panel"
    },
    {
      "type": "range",
      "id": "section_spacing",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "px",
      "label": "Spacing Between Panels",
      "default": 0
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "story_panel",
      "name": "Story Panel",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image",
          "info": "Recommended: Square or 4:3 ratio (e.g., 1200 x 1200px)"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video (Optional)",
          "info": "Video will override image if provided"
        },
        {
          "type": "image_picker",
          "id": "mobile_image",
          "label": "Mobile Image",
          "info": "Optional. Different image for mobile devices."
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading",
          "default": "Chapter 01"
        },
        {
          "type": "textarea",
          "id": "heading",
          "label": "Heading",
          "default": "Our Beginning"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Every piece tells a story of dedication, quality, and timeless design that transcends trends.</p>"
        },
        {
          "type": "text",
          "id": "button_label",
          "label": "Button Label (Optional)"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link"
        },
        {
          "type": "select",
          "id": "image_position",
          "label": "Image Position",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left",
          "info": "Position of image. Will alternate automatically on mobile."
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "min": 0,
          "max": 70,
          "step": 10,
          "unit": "%",
          "label": "Image Overlay Opacity",
          "default": 20
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Brand Story Split",
      "blocks": [
        {
          "type": "story_panel",
          "settings": {
            "subheading": "Chapter 01",
            "heading": "Our Beginning",
            "description": "<p>Born from a passion for timeless design and exceptional quality.</p>",
            "image_position": "left"
          }
        },
        {
          "type": "story_panel",
          "settings": {
            "subheading": "Chapter 02",
            "heading": "Craftsmanship",
            "description": "<p>Every detail meticulously crafted by skilled artisans.</p>",
            "image_position": "right"
          }
        },
        {
          "type": "story_panel",
          "settings": {
            "subheading": "Chapter 03",
            "heading": "Your Story",
            "description": "<p>Designed to become part of your everyday moments.</p>",
            "image_position": "left"
          }
        }
      ]
    }
  ]
}
{% endschema %}

{%- style -%}
  .section-brand-story-split {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-brand-story-split {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .story-split-panel {
    display: flex;
    flex-direction: column;
    gap: 0;
    margin-bottom: {{ section.settings.section_spacing }}px;
    min-height: {{ section.settings.section_height }}px;
    overflow: hidden;
  }

  @media screen and (min-width: 768px) {
    .story-split-panel {
      flex-direction: row;
      align-items: stretch;
    }

    .story-split-panel--reverse {
      flex-direction: row-reverse;
    }
  }

  /* Image Side */
  .story-split__image-wrapper {
    position: relative;
    flex: 1;
    min-height: 400px;
    overflow: hidden;
    background: #f4f4f4;
  }

  @media screen and (min-width: 768px) {
    .story-split__image-wrapper {
      min-height: auto;
    }
  }

  .story-split__image-inner {
    position: absolute;
    top: -10%;
    left: 0;
    width: 100%;
    height: 120%;
  }

  .story-split__image,
  .story-split__image-inner picture {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    will-change: transform;
  }

  .story-split__image-inner picture img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .story-split__overlay {
    position: absolute;
    inset: 0;
    background: #000;
    pointer-events: none;
    z-index: 1;
  }

  /* Content Side */
  .story-split__content {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 3rem 2rem;
    opacity: 0;
    transform: translateY(30px);
  }

  @media screen and (min-width: 768px) {
    .story-split__content {
      padding: 4rem 6vw;
    }
  }

  @media screen and (min-width: 1200px) {
    .story-split__content {
      padding: 4rem 8vw;
    }
  }

  .story-split__subheading {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    opacity: 0.7;
    margin-bottom: 1rem;
    display: block;
    font-weight: 500;
  }

  .story-split__heading {
    font-size: clamp(2rem, 4vw, 3.5rem);
    font-weight: 300;
    line-height: 1.1;
    margin: 0 0 1.5rem 0;
    text-transform: uppercase;
    letter-spacing: -0.02em;
  }

  .story-split__description {
    font-size: clamp(0.95rem, 1.5vw, 1.1rem);
    line-height: 1.7;
    opacity: 0.85;
    margin: 0 0 2rem 0;
    font-weight: 300;
    max-width: 600px;
  }

  .story-split__description p {
    margin: 0 0 1rem 0;
  }

  .story-split__description p:last-child {
    margin-bottom: 0;
  }

  .story-split__btn {
    display: inline-block;
    padding: 1rem 2.5rem;
    border: 1px solid currentColor;
    border-radius: 999px;
    text-decoration: none;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    color: inherit;
    align-self: flex-start;
  }

  .story-split__btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* Hover Effects */
  @media screen and (min-width: 768px) {
    .story-split-panel:hover .story-split__image {
      transform: scale(1.05);
    }

    .story-split__image {
      transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
  }
{%- endstyle -%}

<div class="section-brand-story-split color-{{ section.settings.color_scheme }}">
  {%- for block in section.blocks -%}
    {%- assign image_pos = block.settings.image_position | default: 'left' -%}
    {%- assign reverse_class = '' -%}
    {%- if image_pos == 'right' -%}
      {%- assign reverse_class = ' story-split-panel--reverse' -%}
    {%- endif -%}

    <div class="story-split-panel{{ reverse_class }}" data-story-panel {{ block.shopify_attributes }}>
      {%- comment -%} Image Side {%- endcomment -%}
      <div class="story-split__image-wrapper">
        <div class="story-split__image-inner" data-parallax-image>
          {%- if block.settings.video != blank -%}
            {{
              block.settings.video
              | video_tag: autoplay: true, loop: true, muted: true, controls: false, class: 'story-split__image'
            }}
          {%- elsif block.settings.mobile_image != blank -%}
            <picture>
              <source media="(max-width: 767px)" srcset="{{ block.settings.mobile_image | image_url: width: 1000 }}">
              <source media="(min-width: 768px)" srcset="{{ block.settings.image | image_url: width: 1500 }}">
              {{
                block.settings.image
                | image_url: width: 1500
                | image_tag: class: 'story-split__image', loading: 'lazy'
              }}
            </picture>
          {%- elsif block.settings.image != blank -%}
            {{
              block.settings.image
              | image_url: width: 1500
              | image_tag: class: 'story-split__image', loading: 'lazy'
            }}
          {%- else -%}
            {{ 'lifestyle-' | append: forloop.index | placeholder_svg_tag: 'story-split__image placeholder-svg' }}
          {%- endif -%}
        </div>
        <div
          class="story-split__overlay"
          style="opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }}"
        ></div>
      </div>

      {%- comment -%} Content Side {%- endcomment -%}
      <div class="story-split__content" data-story-content>
        {%- if block.settings.subheading != blank -%}
          <span class="story-split__subheading">{{ block.settings.subheading }}</span>
        {%- endif -%}

        {%- if block.settings.heading != blank -%}
          <h2 class="story-split__heading">{{ block.settings.heading }}</h2>
        {%- endif -%}

        {%- if block.settings.description != blank -%}
          <div class="story-split__description">{{ block.settings.description }}</div>
        {%- endif -%}

        {%- if block.settings.button_label != blank and block.settings.button_link != blank -%}
          <a href="{{ block.settings.button_link }}" class="story-split__btn">
            {{ block.settings.button_label }}
          </a>
        {%- endif -%}
      </div>
    </div>
  {%- else -%}
    {%- comment -%} Placeholder panels if no blocks {%- endcomment -%}
    {%- for i in (1..3) -%}
      {%- assign reverse_class = '' -%}
      {%- if i == 2 -%}
        {%- assign reverse_class = ' story-split-panel--reverse' -%}
      {%- endif -%}

      <div class="story-split-panel{{ reverse_class }}" data-story-panel>
        <div class="story-split__image-wrapper">
          <div class="story-split__image-inner" data-parallax-image>
            {{ 'lifestyle-' | append: i | placeholder_svg_tag: 'story-split__image placeholder-svg' }}
          </div>
          <div class="story-split__overlay" style="opacity: 0.2"></div>
        </div>

        <div class="story-split__content" data-story-content>
          <span class="story-split__subheading">Chapter 0{{ i }}</span>
          <h2 class="story-split__heading">Your Story Here</h2>
          <div class="story-split__description">
            <p>Add your brand narrative to create an engaging experience.</p>
          </div>
        </div>
      </div>
    {%- endfor -%}
  {%- endfor -%}
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') {
      console.warn('GSAP or ScrollTrigger not loaded. Animations disabled.');
      return;
    }

    gsap.registerPlugin(ScrollTrigger);

    const panels = document.querySelectorAll('[data-story-panel]');

    panels.forEach((panel) => {
      const imageWrapper = panel.querySelector('[data-parallax-image]');
      const content = panel.querySelector('[data-story-content]');

      // Image Parallax
      if (imageWrapper) {
        const imageElement = imageWrapper.querySelector('.story-split__image, picture');
        if (imageElement) {
          gsap.fromTo(
            imageElement,
            { yPercent: -8 },
            {
              yPercent: 8,
              ease: 'none',
              scrollTrigger: {
                trigger: panel,
                start: 'top bottom',
                end: 'bottom top',
                scrub: true,
              },
            }
          );
        }
      }

      // Content Reveal
      if (content) {
        gsap.fromTo(
          content,
          { opacity: 0, y: 30 },
          {
            opacity: 1,
            y: 0,
            duration: 1,
            ease: 'power3.out',
            scrollTrigger: {
              trigger: panel,
              start: 'top 75%',
              toggleActions: 'play none none reverse',
            },
          }
        );
      }
    });
  });
</script>
