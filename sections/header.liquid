{% comment %}
  Header Redesign
  Based on references/header.html with Tailwind CSS converted to custom CSS.
{% endcomment %}

{% schema %}
{
  "name": "t:names.header",
  "class": "header-section",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "t:sections.header.settings.menu.label"
    },

    {
      "type": "select",
      "id": "sticky_header_type",
      "options": [
        { "value": "none", "label": "t:sections.header.settings.sticky_header_type.options__1.label" },
        { "value": "on-scroll-up", "label": "t:sections.header.settings.sticky_header_type.options__2.label" },
        { "value": "always", "label": "t:sections.header.settings.sticky_header_type.options__3.label" }
      ],
      "default": "always",
      "label": "t:sections.header.settings.sticky_header_type.label"
    },
    {
      "type": "header",
      "content": "Sticky Header Overrides"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header_product",
      "default": false,
      "label": "Enable sticky header on product page"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header_collection",
      "default": false,
      "label": "Enable sticky header on collection page"
    },
    {
      "type": "checkbox",
      "id": "enable_sticky_header_cart",
      "default": false,
      "label": "Enable sticky header on cart page"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent_header",
      "default": true,
      "label": "t:sections.header.settings.enable_transparent_header.label"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent_header_product",
      "default": false,
      "label": "Enable transparent header on product page"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent_header_collection",
      "default": true,
      "label": "Enable transparent header on collection page"
    },
    {
      "type": "checkbox",
      "id": "enable_transparent_header_page",
      "default": true,
      "label": "Enable transparent header on pages"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "_header-logo"
    },
    {
      "type": "_header-menu"
    }
  ]
}
{% endschema %}

{%- liquid
  assign sticky_header_type = section.settings.sticky_header_type

  # Disable sticky header on specific pages unless explicitly enabled
  if template.name == 'product' and section.settings.enable_sticky_header_product == false
    assign sticky_header_type = 'none'
  elsif template.name == 'collection' and section.settings.enable_sticky_header_collection == false
    assign sticky_header_type = 'none'
  elsif template.name == 'list-collections' and section.settings.enable_sticky_header_collection == false
    assign sticky_header_type = 'none'
  elsif template.name == 'cart' and section.settings.enable_sticky_header_cart == false
    assign sticky_header_type = 'none'
  endif

  assign transparent_header = false
  if template.name == 'index' and section.settings.enable_transparent_header
    assign transparent_header = true
  elsif template.name == 'product' and section.settings.enable_transparent_header_product
    assign transparent_header = true
  elsif template.name == 'collection' and section.settings.enable_transparent_header_collection
    assign transparent_header = true
  elsif template.name == 'list-collections' and section.settings.enable_transparent_header_collection
    assign transparent_header = true
  elsif template.name == 'cart'
    assign transparent_header = true
  elsif template.name == 'page' and section.settings.enable_transparent_header_page
    assign transparent_header = true
  endif

  assign logo = settings.logo
  assign logo_height = settings.logo_height | default: 30
  assign logo_width = logo_height | times: logo.aspect_ratio | round
  assign logo_height_mobile = settings.logo_height_mobile | default: 20
  assign logo_width_mobile = logo_height_mobile | times: logo.aspect_ratio | round
-%}

{% style %}
  /* Custom Variables mapped from Reference Tailwind Config */
  .header-custom {
    --color-burgundy-100: #5d0f17;
    --color-off-white: #f2f0ed;
    --color-white: #fff;
    --color-dark-burgundy: #300000;
    --header-bg-color: var(--color-off-white);
    --header-text-color: var(--color-burgundy-100);

    --header-height: 90px;
    --header-padding: 15px; /* gap-xxs */
    --nav-btn-height: 35px;
    --nav-btn-min-width: 70px;
    --nav-btn-hover-width: 120px;

    --icon-stroke-width: 1.5px; /* Ensure icons are visible */
  }

  @media screen and (min-width: 768px) {
    .header-custom {
      --header-height: 120px; /* h-nav */
      --header-padding: 30px; /* px-md approx */
      --nav-btn-height: 40px;
    }
  }

  /* Sticky & Transparent Logic */
  .header-custom.header-wrapper {
    position: relative;
    z-index: 100;
    width: 100%;
    transition: transform 0.3s ease, background-color 0.3s ease, color 0.3s ease;
    background-color: var(--header-bg-color);
    color: var(--header-text-color);
  }

  .header-custom.header-wrapper[data-sticky-type='always'] {
    position: sticky;
    top: 0;
  }

  .header-custom.header-wrapper[data-sticky-type='on-scroll-up'] {
    position: fixed;
    top: 0;
    width: 100%;
  }

  .header-custom.header-wrapper.is-transparent {
    position: absolute;
    top: 0;
    left: 0;
    background: transparent;
    color: var(--color-white);
    border-bottom: none;
  }

  .header-custom.header-wrapper.is-transparent[data-sticky-type='on-scroll-up'],
  .header-custom.header-wrapper.is-transparent[data-sticky-type='always'] {
    position: fixed; /* Force fixed for transparent sticky so it overlays */
  }

  .header-inner {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 var(--header-padding);
    height: var(--header-height);
    width: 100%;
    margin: 0 auto;
    max-width: var(--page-width, 1440px);
  }

  /* Left: Menu Button */
  .header-left {
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 2;
  }

  /* Hide default details summary from header-drawer */
  .header-left header-drawer > details > summary {
    display: none !important;
  }

  .btn-header-pill {
    display: flex;
    align-items: center;
    justify-content: center; /* Center icon when text is hidden */
    height: var(--nav-btn-height);
    min-width: 44px; /* Sufficient for a circle/pill */
    padding: 0 4px; /* Reduced padding, text margin handles spacing */
    border-radius: 9999px;
    background-color: var(--color-white);
    color: var(--color-burgundy-100);
    border: none;
    cursor: pointer;
    overflow: hidden;
    /* Remove fixed max-width on parent, animate children instead or allow auto growth */
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    text-decoration: none;
  }

  /* Add padding when expanded to look nice */
  .btn-header-pill:hover {
    padding-right: 16px;
    padding-left: 12px;
  }

  /* Specific fix for anchor tags behaving as flex containers */
  a.btn-header-pill {
    box-sizing: border-box;
  }

  .btn-header-pill .icon-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px; /* Fixed width for icon container */
    height: 32px;
    flex-shrink: 0;
  }

  .btn-header-pill .icon-wrapper svg {
    width: 16px;
    height: 16px;
  }

  /* Force burgundy color on icons */
  .btn-header-pill .icon-wrapper svg path,
  .btn-header-pill .icon-wrapper svg circle {
    stroke: #5d0f17 !important;
  }

  .btn-header-pill .text {
    max-width: 0;
    opacity: 0;
    margin-left: 0;
    overflow: hidden;
    white-space: nowrap;
    transition: all 0.3s ease;
    font-size: 13px;
    font-family: 'Poppins', sans-serif; /* Added Poppins font */
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .btn-header-pill:hover .text {
    max-width: 100px; /* Arbitrary large number for text to fit */
    opacity: 1;
    margin-left: 4px;
  }

  /* Center: Logo */
  .header-center {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
  }

  .header-logo-link {
    display: block;
    line-height: 1;
    color: inherit;
    text-decoration: none;
  }

  .header-logo-image {
    display: block;
    height: auto;
    object-fit: contain;
    width: {{ logo_width }}px;
  }

  @media screen and (max-width: 767px) {
    .header-logo-image {
      width: {{ logo_width_mobile }}px;
    }
  }

  .header-logo-text {
    text-transform: uppercase;
    font-size: 24px;
    font-weight: bold;
    letter-spacing: 0.05em;
  }

  /* Right: Actions */
  .header-right {
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 2;
  }

  /* Cart Bubble Position Fix for Pill Button */
  .action-cart {
    position: relative;
  }

  /* Cart Bubble */
  .cart-count-bubble {
    position: absolute;
    background-color: var(--color-button);
    color: var(--color-button-text);
    height: 1.5rem;
    width: 1.5rem;
    border-radius: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.8rem;
    top: -5px;
    right: -10px;
    line-height: 1;
  }

  .action-cart {
    position: relative;
  }

  /* Mobile */
  @media screen and (max-width: 767px) {
    .action-link span.visually-hidden-mobile {
      display: none;
    }
    .header-right {
      gap: 15px;
    }
    .action-account {
      display: none;
    }
  }
{% endstyle %}

<header
  class="header-custom header-wrapper {% if transparent_header %}is-transparent{% endif %}"
  data-sticky-type="{{ sticky_header_type }}"
  data-template-name="{{ template.name }}"
  id="site-header"
>
  <div class="header-inner">
    <!-- LEFT -->
    <div class="header-left">
      {%- if section.settings.menu != blank -%}
        {% render 'header-drawer', linklist: section.settings.menu %}

        <button
          class="btn-header-pill group"
          onclick="const s = this.parentNode.querySelector('summary'); if(s) s.click()"
          aria-label="Menu"
        >
          <span class="icon-wrapper">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 3.5H13" stroke-width="1.5" stroke-linecap="round"/>
              <path d="M1 10.5H13" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="text">Menu</span>
        </button>
      {%- endif -%}
    </div>

    <!-- CENTER -->
    <div class="header-center">
      <a href="{{ routes.root_url }}" class="header-logo-link">
        {%- if logo != blank -%}
          {%- assign image_size_2x = logo_width | times: 2 | at_most: 5760 -%}
          <img
            srcset="{{ logo | image_url: width: logo_width }} 1x, {{ logo | image_url: width: image_size_2x }} 2x"
            src="{{ logo | image_url: width: logo_width }}"
            loading="eager"
            width="{{ logo_width }}"
            height="{{ logo_height }}"
            alt="{{ logo.alt | default: shop.name | escape }}"
            class="header-logo-image"
          >
        {%- else -%}
          <span class="h2 header-logo-text">{{ shop.name }}</span>
        {%- endif -%}
      </a>
    </div>

    <!-- RIGHT -->
    <div class="header-right">
      <button
        class="btn-header-pill action-search"
        onclick="const sm = document.getElementById('search-modal'); if(sm) sm.showDialog()"
        aria-label="{{ 'content.search' | t }}"
      >
        <span class="icon-wrapper">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="6" cy="6" r="4.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12.5 12.5L9.5 9.5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
        <span class="text">Search</span>
      </button>

      {%- if shop.customer_accounts_enabled -%}
        <a
          href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
          class="btn-header-pill action-account"
        >
          <span class="icon-wrapper">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7 7C8.65685 7 10 5.65685 10 4C10 2.34315 8.65685 1 7 1C5.34315 1 4 2.34315 4 4C4 5.65685 5.34315 7 7 7Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M13 13C13 10.2386 10.3137 8 7 8C3.68629 8 1 10.2386 1 13" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="text">Sign In</span>
        </a>
      {%- endif -%}

      {%- if settings.cart_type == 'drawer' and template.name != 'cart' -%}
        <script src="{{ 'cart-drawer.js' | asset_url }}" type="module" fetchpriority="low"></script>

        {% capture empty_cart_drawer_content %}
          <div class="cart-drawer__header">
            <button
              ref="closeButton"
              on:click="cart-drawer-component/close"
              class="button close-button cart-drawer__close-button button-unstyled"
              aria-label="{{ 'actions.close' | t }}"
            >
              <span class="svg-wrapper">
                {{- 'icon-close.svg' | inline_asset_content -}}
              </span>
            </button>
          </div>

          <div
            class="cart-drawer__content"
            aria-label="{{ 'content.cart_title' | t }}"
          >
            <h2 class="cart-drawer__heading h4 cart-drawer__heading--empty">
              {{ 'content.your_cart_is_empty' | t }}
            </h2>

            <div class="cart-drawer__items">
              {% render 'cart-products', force_empty: true %}
            </div>
          </div>
        {% endcapture %}

        <cart-drawer-component
          class="cart-drawer"
          {% if settings.auto_open_cart_drawer %}
            auto-open
          {% endif %}
        >
          <template id="empty-cart-template">
            {{ empty_cart_drawer_content }}
          </template>

          <button
            class="btn-header-pill action-cart"
            id="cart-icon-bubble"
            on:click="/open"
            aria-haspopup="dialog"
            aria-label="{{ 'content.cart_title' | t }}"
          >
            <span class="icon-wrapper">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 1H2.5L3.9 8.02C3.96 8.32 4.09 8.59 4.29 8.81C4.49 9.03 4.75 9.17 5.05 9.22H11.55C11.85 9.17 12.11 9.03 12.31 8.81C12.51 8.59 12.64 8.32 12.7 8.02L13.5 4H3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="5" cy="12" r="1" stroke-width="1.5"/>
                <circle cx="11" cy="12" r="1" stroke-width="1.5"/>
              </svg>
            </span>
            <span class="text">{{ cart.item_count }} Items</span>
            {%- if cart != empty and cart.item_count > 0 -%}
              <div class="cart-count-bubble">
                <span aria-hidden="true">{{ cart.item_count }}</span>
              </div>
            {%- endif -%}
          </button>

          <dialog
            ref="dialog"
            class="cart-drawer__dialog dialog-modal dialog-drawer color-{{ settings.drawer_color_scheme }}{% if cart.empty? %} cart-drawer--empty{%endif%}"
            aria-labelledby="cart-drawer-heading"
            scroll-lock
            cart-summary-sticky="true"
          >
            <div class="cart-drawer__inner" data-hydration-key="cart-drawer-inner">
              <cart-items-component class="cart-items-component" data-drawer data-section-id="{{ section.id }}">
                {%- if cart.empty? -%}
                  {{ empty_cart_drawer_content }}
                {%- else -%}
                  <div class="cart-drawer__header" id="cart-drawer-header">
                    <h2 class="cart-drawer__heading h4" id="cart-drawer-heading">
                      {{ 'content.cart_title' | t }}
                    </h2>
                    <button
                      ref="closeButton"
                      on:click="cart-drawer-component/close"
                      class="button close-button cart-drawer__close-button button-unstyled"
                      aria-label="{{ 'actions.close' | t }}"
                    >
                      <span class="svg-wrapper">
                        {{- 'icon-close.svg' | inline_asset_content -}}
                      </span>
                    </button>
                  </div>

                  <scroll-hint
                    class="cart-drawer__content"
                    aria-label="{{ 'content.cart_title' | t }}"
                    style="--header-height: 60px;"
                  >
                    <div class="cart-drawer__items">
                      {% render 'cart-products' %}
                    </div>
                    <div class="cart-drawer__summary">
                      {% render 'cart-summary', section_id: section.id %}
                    </div>
                  </scroll-hint>
                {%- endif -%}
              </cart-items-component>
            </div>
          </dialog>
        </cart-drawer-component>
      {%- else -%}
        <a href="{{ routes.cart_url }}" class="btn-header-pill action-cart" id="cart-icon-bubble">
          <span class="icon-wrapper">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1H2.5L3.9 8.02C3.96 8.32 4.09 8.59 4.29 8.81C4.49 9.03 4.75 9.17 5.05 9.22H11.55C11.85 9.17 12.11 9.03 12.31 8.81C12.51 8.59 12.64 8.32 12.7 8.02L13.5 4H3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <circle cx="5" cy="12" r="1" stroke-width="1.5"/>
              <circle cx="11" cy="12" r="1" stroke-width="1.5"/>
            </svg>
          </span>
          <span class="text">{{ cart.item_count }} Items</span>
          {%- if cart != empty and cart.item_count > 0 -%}
            <div class="cart-count-bubble">
              <span aria-hidden="true">{{ cart.item_count }}</span>
            </div>
          {%- endif -%}
        </a>
      {%- endif -%}
    </div>
  </div>
</header>
<script>
  (() => {
    const header = document.getElementById('site-header');
    if (!header) return;

    // Sticky header logic
    const stickyType = header.dataset.stickyType;
    let lastScrollY = window.scrollY;

    // Check initial transparency state
    const isInitiallyTransparent = {{ transparent_header | json }};

    const handleScroll = () => {
        const currentScrollY = window.scrollY;
        const isScrollingDown = currentScrollY > lastScrollY;

        // Sticky Logic - Hide/Show on scroll
        if (stickyType === 'on-scroll-up') {
             if (isScrollingDown && currentScrollY > 200) {
                 // Scrolling DOWN -> Hide
                 header.style.transform = 'translateY(-100%)';
             } else {
                 // Scrolling UP -> Show
                 header.style.transform = 'translateY(0)';
             }
        }

        lastScrollY = currentScrollY;
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    // Run once on load
    handleScroll();
  })();
</script>
